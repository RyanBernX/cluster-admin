# 硬件相关

购买新机器后，理论上管理员从这个时候就应该参与集群的搭建了。服务器供应商会将所购买的产品运到机房，可能出现以下情况：

1. 购买的是单个或零散的工作站/服务器。
2. 购买的是集群套装（包含机柜，服务器，交换机，磁盘阵列等）

如果是第一种情况，送货人员只要保证机器能开机能进入系统就行（通常机器上都会自带一个系统）。如果是第二种情况，厂家一般会派来专门的工程师进行部署（机器上架，安装系统，配置 IP 地址，安装驱动等）。一个功能比较完整的集群应该包括如下硬件：

### 机柜

用于存放其他设备，并负责各种主机、交换机、KVM 等主要设备的供电。

### 各种主机

用于计算/登录/管理的服务器（又称为“**节点**”），按照角色划分为：

* 管理节点（负责运行各种服务端，进行全局配置）
* 计算节点（用于计算）
* 登录节点（直接和外网相连，用于登录交互）
* 存储节点（用于管理集群存储）

一般来讲一台服务器只充当其中一个角色，但在服务器数量不足时可能会出现二合一或者多合一的情况，例如对于节点数量较少的集群，同一台机器可以既是管理节点又是登录节点，甚至也可以是存储节点。一般情况下，不建议将充当计算节点的机器用作其它用途。

### 交换机

交换机（switch）主要负责集群所有设备的局域网互联，按照带宽可分为：千兆交换机、万兆交换机、Infiniband 交换机等。一般来讲一个集群的局域网至少有两个网段：

* 管理网：通常为千兆网（1Gbps），主要用于管理方面的通讯。
* 计算网：至少为万兆或 Infiniband，延迟低速度快（可达 100Gbps），主要用于并行程序通讯，网络磁盘挂载等，自然价格也非常贵（需要专门的网线，网卡，驱动）。

如果稍微穷一点，可能只有一个管理网段，负责全部局域网互联。如果想自己搭建的话至少买个千兆的（接口数量根据自己使用情况），价格一般可以接受。

对于小型集群（50 机器以内），可以将所有机器连在一个交换机上（星形结构），对于更大规模的集群网络拓扑会变得更复杂，不在本指南的讨论范围之内。

### 磁盘阵列

一个放满磁盘的机器壳子，里面有一个小型的系统，磁盘基本上会被做成 Raid5 或者 Raid10。在小规模集群上，磁盘阵列需要先和存储节点相连，然后存储节点通过文件服务将磁盘共享给其它节点。由于是硬件 Raid，磁盘阵列的吞吐性能要比单个磁盘要好。

{% hint style="info" %}
有些集群没有磁盘阵列，而是直接在存储节点加装大量硬盘然后共享。存储节点也会有磁盘阵列卡，使用起来和磁盘阵列差不多。
{% endhint %}

### KVM（可选）

{% hint style="warning" %}
这里的 KVM 不是指虚拟机技术。
{% endhint %}

KVM 切换器（KVM switch）可以方便使用一组键盘、鼠标、显示器来控制集群的各个节点，想对哪个节点进行操作就切换到相应节点，非常方便。如果没有 KVM 就只能手动插拔显示器和键盘的线，体验很不好。

KVM 提供的是终端登录，并不像 SSH 那样是远程服务。使用 KVM 和先登录一台机器然后 SSH 到其它机器还是很不一样的。

### UPS（可选）

UPS 在突然断电时可以提供临时电力，以供管理员及时响应，保存数据并正常关机。需要注意是 UPS 达到使用年限就需要及时更换，不然会有引发火灾的危险。

### 其它设备

不直接和机器相关的设备如空调、温控器、摄像头等需要额外购买，但不是本指南的重点。

